{
  "pluginType": "DB",
  "pluginId": "postgres-plugin",
  "unpublishedAction": {
    "name": "Query2",
    "datasource": {
      "name": "learner1",
      "pluginId": "postgres-plugin",
      "messages": [],
      "isAutoGenerated": false,
      "id": "learner1",
      "deleted": false,
      "policies": [],
      "userPermissions": []
    },
    "pageId": "Page1",
    "actionConfiguration": {
      "timeoutInMillisecond": 10000,
      "paginationType": "NONE",
      "encodeParamsToggle": true,
      "body": "/* \n  Query to fetch payments grouped by amount, where the amount is 3398 or 4198, \n  within a specified date range, the status is 'responseReceivedSuccess', \n  and paymentForId is NULL. Join with UserCourse table to find entries with courseId 4016.\n  Exclude cases where startedAt and expiryAt differ by less than 5 days.\n*/\n\nWITH FilteredPayments AS (\n  SELECT \"amount\", \"userId\"\n  FROM \"Payment\"\n  WHERE \"createdAt\" >= {{moment(DatePicker1.selectedDate).format(\"YYYY-MM-DD\")}}::date - interval '330 minutes'\n    AND \"createdAt\" <= {{moment(DatePicker2.selectedDate).format(\"YYYY-MM-DD\")}}::date + interval '1110 minutes'\n    AND \"status\" = 'responseReceivedSuccess'\n    AND \"amount\" IN (3398, 4198)\n    AND \"paymentForId\" IS NULL\n)\nSELECT fp.\"amount\", COUNT(fp.\"userId\") AS payment_count, SUM(fp.\"amount\") AS total_amount\nFROM FilteredPayments fp\nJOIN \"UserCourse\" uc ON fp.\"userId\" = uc.\"userId\"\nWHERE uc.\"courseId\" = 4016\n  AND (uc.\"expiryAt\" - uc.\"startedAt\") >= interval '7 days'\nGROUP BY fp.\"amount\";\n",
      "selfReferencingDataPaths": [],
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ]
    },
    "executeOnLoad": true,
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "isValid": true,
    "invalids": [],
    "messages": [],
    "jsonPathKeys": [
      "moment(DatePicker1.selectedDate).format(\"YYYY-MM-DD\")",
      "moment(DatePicker2.selectedDate).format(\"YYYY-MM-DD\")"
    ],
    "userSetOnLoad": false,
    "confirmBeforeExecute": false,
    "policies": [],
    "userPermissions": [],
    "createdAt": "2024-05-21T10:19:00Z"
  },
  "id": "Page1_Query2",
  "deleted": false,
  "gitSyncId": "663c66906e6b233d172c3060_0be9d827-ec14-4e92-9969-ebeb166a585a"
}